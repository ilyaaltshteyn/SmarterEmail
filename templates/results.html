<!doctype html>
<title>Send javascript with template demo</title>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Questrial|Cutive%20Mono">
</head>

<script src="http://code.jquery.com/jquery-latest.js"></script>

<style>
/*THIS IS HERE FOR NOW TO AVOID HAVING TO USE
STREAM_WITH_CONTEXT WHEN RENDERING THIS TEMPLATE*/

#data {
  text-align: center;
}
.loader {
  border: 16px solid #f3f3f3; /* Light grey */
  border-top: 16px solid #3E606F; /* Dark blue */
  border-radius: 50%;
  width: 120px;
  height: 120px;
  animation: spin 2s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

</style>

<div class = "loader"></div>
<div id="data">Loading... This may take a while, up to 1 minute.</div>
{% for i in data: %}
<script>

  function prepData(encodedString) {
    // Decodes a string encoded as htmlspecialchars, which our data is.
    var textArea = document.createElement('textarea');
    textArea.innerHTML = encodedString;
    return JSON.parse(textArea.value);
   }

  $(".loader").hide();
  var a = prepData("{{ i }}");
  $("#data").text(a);

</script>
{% endfor %}

<div id = 'sentCountsHist'></div>

<script>
// This script plots the sentence counts histogram in the sentCountsHist div

var binsDict = {'1 - 2 sentences' : 0, '3 - 5 sentences' : 0,
                '6 - 10 sentences' : 0, '11+ sentences' : 0};

// Loop through the sentence counts and increment counts for each bin
var values = a['sentence_counts'];

for (i = 0; i < values.length; i++){
  var v = values[i];
  if (v <= 2) { binsDict['1 - 2 sentences']++; }
  else if (v > 2 && v <= 5) { binsDict['3 - 5 sentences']++; }
  else if (v > 5 && v <= 10) { binsDict['6 - 10 sentences']++; }
  else { binsDict['11+ sentences']++; }
};

var xVals = ['1 - 2', '3 - 5', '6 - 10', '11+']
var yVals = [binsDict['1 - 2 sentences'], binsDict['3 - 5 sentences'],
            binsDict['6 - 10 sentences'], binsDict['11+ sentences']]
var colors = ['rgba(70,137,102,1)', 'rgba(255,240,165,1)', 'rgba(255,176,59,1)', 'rgba(182,73,38,1)'];

var data = [{
  x: xVals,
  y: yVals,
  marker:{
    color: colors
  },
  type: 'bar'
}];

var layout = {
  title: 'Email Body Length in Sentences',
  hovermode: !1,
  font: {
    size: 14,
    color: 'rgba(51,51,51,0.8)',
    family: "Questrial"
  }
};

Plotly.newPlot('sentCountsHist', data, layout, {displayModeBar: false});

</script>
